imports:

- classpath:/common/directors.yaml
- classpath:/common/groovy/actors.yaml

components:

# actors

<%include file="wpsActors.yaml"/>

# workflow

- id: SimpleWorkflow
  type: Workflow
  properties:
    director: !ref MTDataDrivenDirector
    nodes:
    - !ref GetSource
    - !ref WaitForSources
    - !ref RunWorker
    - !ref WriteResult
    - !ref WriteStatus
    - !ref WriteStatusLocation

- id: GetSource
  type: Node
  properties:
    actor: !ref WpsExecute
    constants:
      service: ${nodes['source'].get('service')}
      identifier: ${nodes['source'].get('identifier')}
      input: ${nodes['source'].get('input')}
      complex_input: ${nodes['source'].get('complex_input')}
      output: ${nodes['source'].get('output')}
      verbose: false
    sequences:
      sources: ${nodes['source'].get('sources')}
    outflows:
      result: /source/
      statusLocation: /sourceStatusLocation/
      status: /sourceStatus/

- id: WaitForSources
  type: Node
  properties:
    actor: !ref CollectSources
    constants:
      max: ${len(nodes['source'].get('sources'))}
    inflows:
      source: /source/
      statusLocation: /sourceStatusLocation/
    outflows:
      sources: /sources/
      statusLocations: /sourceStatusLocations/

- id: RunWorker
  type: Node
  properties:
    actor: !ref WpsExecute
    constants:
      service: ${nodes['worker'].get('service')}
      identifier: ${nodes['worker'].get('identifier')}
      input: ${nodes['worker'].get('input')}
      complex_input: ${nodes['worker'].get('complex_input')}  
      output: ${nodes['worker'].get('output')}
      verbose: false
    inflows:
      sources: /sources/
    outflows:
      result: /worker/
      statusLocation: /workerStatusLocation/
      status: /workerStatus/
 
- id: WriteResult
  type: Node
  properties:
    actor: !ref FileWriter
    constants:
      filename: restflow_output.txt
    inflows:
      message: /worker/

- id: WriteStatusLocation
  type: Node
  properties:
    actor: !ref FileWriter
    constants:
      filename: restflow_status_location.txt
    inflows:
      message: /workerStatusLocation/

- id: WriteStatus
  type: Node
  properties:
    actor: !ref FileWriter
    constants:
      filename: restflow_status.txt
    inflows:
      message: /workerStatus/



