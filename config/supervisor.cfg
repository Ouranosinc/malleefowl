[buildout]

parts +=
      supervisor_install
      supervisor_config
      supervisor_start_stop
      supervisor_restart

[supervisor_install]
recipe = collective.recipe.cmd
on_install = true
on_update = true
cmds =
    ${conda:home}/bin/pip install supervisor --pre
    mkdir -p ${conda:home}/var/log/supervisor
    mkdir -p ${conda:home}/var/run

[supervisor_config]
recipe = collective.recipe.template
input = ${buildout:directory}/templates/supervisord.conf
output = ${conda:home}/etc/supervisor/supervisord.conf

[supervisor_start_stop]
recipe = collective.recipe.template
input = ${buildout:directory}/templates/supervisord
output = ${conda:home}/etc/init.d/supervisord

[supervisor_restart]
recipe = collective.recipe.cmd
on_install = true
on_update = true
cmds =
     unset PYTHONPATH
     ${conda:home}/etc/init.d/supervisord restart

