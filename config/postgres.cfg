[buildout]

parts +=
      postgres_conda
      postgres_initdb
      postgres_config
      postgres_supervisor

[postgres_conda]
recipe = birdhousebuilder.recipe.conda
pkgs = postgresql

[postgres_initdb]
recipe = collective.recipe.cmd
on_install = true
cmds =
     test -d ${buildout:anaconda-home}/var/lib/postgres || ${buildout:anaconda-home}/bin/initdb --auth=trust -D ${buildout:anaconda-home}/var/lib/postgres

[postgres_config]
recipe = collective.recipe.template
input = ${buildout:directory}/templates/postgresql.conf
output = ${buildout:anaconda-home}/var/lib/postgres/postgresql.conf

port = 5432

[postgres_supervisor]
recipe = birdhousebuilder.recipe.supervisor

program = postgres
command = ${buildout:anaconda-home}/bin/postgres -D ${buildout:anaconda-home}/var/lib/postgres
directory = ${buildout:anaconda-home}/var/lib/postgres

     